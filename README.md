# Exam_antfin

title: 笔试报告_蚂蚁金服
tags: 
    - LSTM
    - ARIMA
    - 时间序列分析
    
date: 2018-06-19 14:21:55
categories: "笔试"
mathjax: true
comments: true
---

拿到数据以发现特征只有一列,即资金流的流入流出情况,第一反应是惯性思维用熟悉的LSTM能不能解决问题,但也明白无论怎么从原有数据构造新特征在LSTM上的表现都应该不是很好，花了几个小时处理数据写完模型发现无论如何调整参数构造特征，模型都无法收敛而且过拟合严重,时间有限也无法严格验证LSTM是否有严格的可行性且对该数据业务不了解，所以放弃原有方案采用之前有了解过的符合该数据的ARIMA模型.
<!--more-->

## 模型及方案选择
本次建模根据数据特征（时间序列数据，尝试LSTM和ARIMA模型，选择了时间序列模型ARIMA来预测渠道7月24日至7月28日每天从当日0点到24点的流入流出轧差值（总流入-总流出）。

选择ARIMA方案的理由如下：

    - 数据经检验为平稳模型，符合使用ARIMA模型的要求。
    - 有很多成功解决此类型问题的先例证明此模型的可靠性和有效性。
    - 特征过少不宜使用传统机器学习模型。
    - 模型较为简单易懂，在有限的笔试时间里我可以迅速上手。


----------


由于24日-28日的数据部分已经给出，即24日-28日每天10am前的数据已知。所以预测方案有两个：

    1. 直接舍弃24日至28日的数据，以天为单位统计每日流入流出轧差值，并以此建模，直接预测24日-28日每日流入流出轧差值。
    2. 不舍弃24日至28日的数据,以小时为单位统计计算每小时的流入流出，以此建模，预测24日-28日每日10am后的小时流入流出情况，并和当日已知流入流出情况汇总，得到最终的每日流出轧差值的预测值。


----------


从业务方面考虑，初步认为流入流出轧差值以天为细粒度较为合理，理由如下：

    1. 小时细粒度具有极大的随机性，突发金额流入流出的情况会影响模型的准确性。
    2.一般业务情境中，资金流入流出以天为细粒度具有规律性（数据中也可以大致看出），突发情况较少。
    3.月细粒度会导致数据过少，建模困难。


----------


## 预测结果及分析
由于初次上手ARIMA模型，主要时间花在参数了解和写模型上，参数未能精细调整，可能会影响部分结果，我会在后面写出可能的改进方案。

### 数据处理
由于不了解业务，无法对数据中的异常值进行判断，对于5个缺失值选择用每五分钟的流入流出均值代替，有3340个时间点同时有$RE$和$SE$两种amount，业务情况不清楚所以暂不处理。对$RE$的值标记为负。之后按天聚合得到的数据如图（去除24-29日的数据）：

![1.png-28.6kB][1]

上图基本显示出了一定的平稳性，在一个数值左右波动（如果想更明确，可以计算一维差分来用），通过`Dickey-Fuller Test`来检验其平稳性,结果如下：

    Results of Dickey-Fuller Test:
    Test Statistic                  -4.917220
    p-value                          0.000032
    #Lags Used                       1.000000
    Number of Observations Used    202.000000
    Critical value (1%)             -3.463144
    Critical value (5%)             -2.875957
    Critical value (10%)            -2.574455
    dtype: float64
`Test Statistic`小于置信度为1%时的值，且`p`值远小于0.05，说明序列平稳。

接下来通过$ACF$,$PACF$进行$ARIMA（p，d，q)$的$p$，$q$参数估计：

![3.png-13.9kB][2]

参数$d=0$为差分的阶数，从$ACF$,$PACF$图中得到$p=9$,$q=3$.

带入$ARIMA$模型后得到,24日前的历史模拟情况对比：

![4.png-35.9kB][3]

预测24日-28日的情况如图：

![5.png-26kB][4]

24日-28日对应的资金流入流出轧差值的预测值为：
    
    07.24    248680.669874
    07.25    223628.952776
    07.26    212744.495103
    07.27    201486.709855
    07.28    190364.054472


----------

### 结果说明及可能的改进
现学了$ARIMA$中间肯定存在理解失误或者细节调整有问题的地方。从历史拟合数据看，均方根误差较大存在一定的误差，但数据大体趋势正确。

可能的改进方案如下：

    1.依然沿用ARIMA这个解决方案，但调整细节及相关参数（误差白噪声检查，BIC确定p，q值等）。
    2.收集更多维度的特征（如交易笔数，交易渠道等），换用LSTM，RNN等深度学习或者机器学习的时序模型
    3.花更多的时间去寻求业务上的规律
    4.寻求其他的计量经济学模型并进行模型融合以减少误差

## 参考资料

 1. https://www.cnblogs.com/bradleon/p/6827109.html
 2. https://blog.csdn.net/gdyflxw/article/details/55509656



  [1]: http://static.zybuluo.com/y21leaves/qf54d8sbjrx9g7pmztmib84l/1.png
  [2]: http://static.zybuluo.com/y21leaves/o5nk7158joo9zqr0vdxpg3of/3.png
  [3]: http://static.zybuluo.com/y21leaves/9epvrppwgtstyxc7ij5m7ix4/4.png
  [4]: http://static.zybuluo.com/y21leaves/c3fodf9uzrnyvi59pjw0rcen/5.png